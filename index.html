<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Jmsp&#39;s Tips</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Jmsp's Tips">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jmsp's Tips">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jmsp's Tips">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Jmsp&#39;s Tips" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/main.css" type="text/css">
  
<!-- baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d400b2b9cf7d1a287b60931c6cbae186";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- End baidu Analytics -->


</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://7xoz39.com1.z0.glb.clouddn.com/BLOG_IMG_0412.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Jmsp</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/categories/OC">OC</a></li>
	        
				<li><a href="/categories/Swift">Swift</a></li>
	        
				<li><a href="/categories/Android">Android</a></li>
	        
				<li><a href="/categories/ReactNative">ReactNative</a></li>
	        
				<li><a href="/categories/PHP">PHP</a></li>
	        
				<li><a href="/categories/Python">Python</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
            
    			
            
    			
            
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/zhangzhaopds weibo: " title="github">github</a>
		        
					<a class="rss" target="_blank" href="/#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Jmsp</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://7xoz39.com1.z0.glb.clouddn.com/BLOG_IMG_0412.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Jmsp</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/OC">OC</a></li>
		        
					<li><a href="/categories/Swift">Swift</a></li>
		        
					<li><a href="/categories/Android">Android</a></li>
		        
					<li><a href="/categories/ReactNative">ReactNative</a></li>
		        
					<li><a href="/categories/PHP">PHP</a></li>
		        
					<li><a href="/categories/Python">Python</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/zhangzhaopds weibo: " title="github">github</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-【Python】简单应用-刷博客访问量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/24/【Python】简单应用-刷博客访问量/">【Python】简单应用--刷博客访问量</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>利用随机生成请求header，对同一地址进行假身份访问；</p>
</blockquote>
<p><a href="https://github.com/zhangzhaopds/request_demo" target="_blank" rel="external">代码地址：https://github.com/zhangzhaopds/request_demo</a></p>
<h5 id="randomHeader-py"><a href="#randomHeader-py" class="headerlink" title="randomHeader.py"></a>randomHeader.py</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randHeader</span><span class="params">()</span>:</span></span><br><span class="line">    head_connection = [<span class="string">'Keep-Alive'</span>, <span class="string">'close'</span>]</span><br><span class="line">    head_accept = [<span class="string">'text/html, application/xhtml+xml, */*'</span>]</span><br><span class="line">    head_accept_language = [<span class="string">'zh-CN,fr-FR;q=0.5'</span>, <span class="string">'en-US,en;q=0.8,zh-Hans-CN;q=0.5,zh-Hans;q=0.3'</span>]</span><br><span class="line">    head_user_agent = [<span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.95 Safari/537.36'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; rv:11.0) like Gecko)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.2) Gecko/2008070208 Firefox/3.0.1'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070309 Firefox/2.0.0.3'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070803 Firefox/1.5.0.12'</span>,</span><br><span class="line">                       <span class="string">'Opera/9.27 (Windows NT 5.2; U; zh-cn)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Macintosh; PPC Mac OS X; U; en) Opera 8.0'</span>,</span><br><span class="line">                       <span class="string">'Opera/8.0 (Macintosh; PPC Mac OS X; U; en)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12) Gecko/20080219 Firefox/2.0.0.12 Navigator/9.0.0.6'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64; Trident/4.0)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2; .NET4.0C; .NET4.0E)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Maxthon/4.0.6.2000 Chrome/26.0.1410.43 Safari/537.1 '</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2; .NET4.0C; .NET4.0E; QQBrowser/7.3.9825.400)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:21.0) Gecko/20100101 Firefox/21.0 '</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.92 Safari/537.1 LBBROWSER'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; BIDUBrowser 2.x)'</span>,</span><br><span class="line">                       <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/3.0 Safari/536.11'</span>]</span><br><span class="line"></span><br><span class="line">    header = &#123;</span><br><span class="line">        <span class="string">'Connection'</span>: head_connection[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'Accept'</span>: head_accept[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'Accept-Language'</span>: head_accept_language[<span class="number">1</span>],</span><br><span class="line">        <span class="string">'User-Agent'</span>: head_user_agent[random.randrange(<span class="number">0</span>, len(head_user_agent))]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> header</span><br></pre></td></tr></table></figure>
<h5 id="request-py"><a href="#request-py" class="headerlink" title="request.py"></a>request.py</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> randomHeader</span><br><span class="line"></span><br><span class="line">print(randomHeader.randHeader())</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'viewmode'</span>: <span class="string">'contents'</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">'content-type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">           <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:22.0) Gecko/20100101 Firefox/22.0'</span>&#125;</span><br><span class="line">req = requests.get(<span class="string">"http://blog.csdn.net/zz110731"</span>, params=data, headers=headers)</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(req.text)</span><br><span class="line"></span><br><span class="line">articles = soup.find_all(class_=<span class="string">'link_title'</span>)</span><br><span class="line"></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> k &lt; <span class="number">100</span>:</span><br><span class="line">    m = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> articles:</span><br><span class="line">        link = <span class="string">'http://blog.csdn.net'</span> + article.a[<span class="string">'href'</span>]</span><br><span class="line">        <span class="comment"># print(link)</span></span><br><span class="line">        head = randomHeader.randHeader()</span><br><span class="line">        qq = requests.get(link, headers=head)</span><br><span class="line">        <span class="comment"># print(head)</span></span><br><span class="line">        m = m + <span class="number">1</span></span><br><span class="line">        print(m)</span><br><span class="line">        print(qq)</span><br><span class="line">    k  = k + <span class="number">1</span></span><br><span class="line">    print(<span class="string">"第&#123;0&#125;次，请求完毕"</span>.format(k))</span><br></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/02/24/【Python】简单应用-刷博客访问量/" class="archive-article-date">
  	<time datetime="2017-02-24T08:45:28.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-02-24</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随机Header/">随机Header</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Python/">Python</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【Python】BeautifulSoup使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/24/【Python】BeautifulSoup使用/">【Python】BeautifulSoup基本使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>BeautifulSoup是Python中用来解析HTML、XML等文档的强大工具。</p>
</blockquote>
<p>Beautiful Soup将复杂HTML文档转换成一个复杂的树形结构,每个节点都是Python对象,所有对象可以归纳为4种: Tag , NavigableString , BeautifulSoup , Comment。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">html_doc = <span class="string">"""</span><br><span class="line">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p class="title"&gt;&lt;b&gt;这个是b标签&lt;/b&gt;&lt;/p&gt;</span><br><span class="line">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;Elsie&lt;/a&gt;,</span><br><span class="line">&lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="line">&lt;p class="story"&gt;...&lt;/p&gt;</span><br><span class="line">"""</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">soup = <span class="function"><span class="title">BeautifulSoup</span><span class="params">(html_doc)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="1、Tag标签对象"><a href="#1、Tag标签对象" class="headerlink" title="1、Tag标签对象"></a>1、Tag标签对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tag = soup.p</span><br><span class="line">print(type(tag))        <span class="comment"># &lt;class 'bs4.element.Tag'&gt;</span></span><br></pre></td></tr></table></figure>
<p>标签的属性可以被添加,删除或修改，操作如字典</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tag[<span class="string">'class'</span>] = <span class="string">"very"</span>   <span class="comment"># 修改属性值</span></span><br><span class="line">tag[<span class="string">'id'</span>] = <span class="number">1</span>           <span class="comment"># 添加id属性</span></span><br><span class="line">print(tag)              <span class="comment"># &lt;p class="verybold" id="1"&gt;&lt;b&gt;你好&lt;/b&gt;&lt;/p&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> tag[<span class="string">'id'</span>]           <span class="comment"># 删除id属性</span></span><br><span class="line">print(tag)              <span class="comment"># &lt;p class="very"&gt;&lt;b&gt;你好&lt;/b&gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>多值属性 返回list类型数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">css_soup = BeautifulSoup(<span class="string">'&lt;p class="body strikeout"&gt;&lt;/p&gt;'</span>)</span><br><span class="line">print(css_soup.p[<span class="string">'class'</span>])      <span class="comment"># ['body', 'strikeout']</span></span><br></pre></td></tr></table></figure>
<p>非多值属性 返回string</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n_css_soup = BeautifulSoup(<span class="string">'&lt;p id="body name"&gt;&lt;/p&gt;'</span>)</span><br><span class="line">print(n_css_soup.p[<span class="string">'id'</span>])       <span class="comment"># body name2、NavigableString：标签中的字符串</span></span><br></pre></td></tr></table></figure>
<h4 id="2、NavigableString标签中的字符串"><a href="#2、NavigableString标签中的字符串" class="headerlink" title="2、NavigableString标签中的字符串"></a>2、NavigableString标签中的字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(type(tag.string))         <span class="comment"># &lt;class 'bs4.element.NavigableString'&gt;</span></span><br><span class="line">print(tag.string)               <span class="comment"># 这个是b标签</span></span><br><span class="line">tag.string.replace_with(<span class="string">'you are beautiful'</span>)</span><br><span class="line">print(tag.string)               <span class="comment"># you are beautiful</span></span><br></pre></td></tr></table></figure>
<h4 id="3、BeautifulSoup对象"><a href="#3、BeautifulSoup对象" class="headerlink" title="3、BeautifulSoup对象"></a>3、BeautifulSoup对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(type(soup))           <span class="comment"># &lt;class 'bs4.BeautifulSoup'&gt;</span></span><br><span class="line">print(soup.name)            <span class="comment"># [document]</span></span><br></pre></td></tr></table></figure>
<h4 id="4、Comment注释及特殊字符串"><a href="#4、Comment注释及特殊字符串" class="headerlink" title="4、Comment注释及特殊字符串"></a>4、Comment注释及特殊字符串</h4><p>Comment 对象是一个特殊类型的 NavigableString 对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">markup = <span class="string">"&lt;b&gt;&lt;!--Hey, buddy. Want to buy a used parser?--&gt;&lt;/b&gt;"</span></span><br><span class="line">mark_soup = BeautifulSoup(markup)</span><br><span class="line">print(type(mark_soup.b.string))     <span class="comment"># &lt;class 'bs4.element.Comment'&gt;</span></span><br><span class="line">print(mark_soup.b.string)           <span class="comment"># Hey, buddy. Want to buy a used parser?</span></span><br><span class="line">print(mark_soup.b.prettify())       <span class="comment"># comment 也可以prettify()格式化输出</span></span><br><span class="line"><span class="comment">#&lt;b&gt;</span></span><br><span class="line"><span class="comment"># &lt;!--Hey, buddy. Want to buy a used parser?--&gt;</span></span><br><span class="line"><span class="comment">#&lt;/b&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="contents"><a href="#contents" class="headerlink" title="contents"></a>contents</h4><p>子节点以list形式输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(soup.head)                <span class="comment"># &lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line">print(soup.head.contents)       <span class="comment"># [&lt;title&gt;The Dormouse's story&lt;/title&gt;]</span></span><br><span class="line">print(soup.head.contents[<span class="number">0</span>])    <span class="comment"># &lt;title&gt;The Dormouse's story&lt;/title&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="children"><a href="#children" class="headerlink" title="children"></a>children</h4><p>子节点迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(type(soup.head.children))     <span class="comment"># &lt;class 'list_iterator'&gt;</span></span><br><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> soup.head.children:</span><br><span class="line">    print(child)</span><br></pre></td></tr></table></figure>
<h4 id="descendants"><a href="#descendants" class="headerlink" title="descendants"></a>descendants</h4><p>子孙节点生成器 递归循环的列出子节点和子孙节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(type(soup.head.descendants))  <span class="comment"># &lt;class 'generator'&gt;</span></span><br><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> soup.head.descendants:</span><br><span class="line">    print(child)</span><br><span class="line">    <span class="comment"># &lt;title&gt;The Dormouse's story&lt;/title&gt;   子节点</span></span><br><span class="line">    <span class="comment"># The Dormouse's story                  孙节点</span></span><br></pre></td></tr></table></figure>
<h4 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h4><p>标签中的字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> soup.strings:</span><br><span class="line">    print(repr(str))</span><br><span class="line"><span class="comment"># '\n'</span></span><br><span class="line"><span class="comment"># "The Dormouse's story"</span></span><br><span class="line"><span class="comment"># '\n'</span></span><br><span class="line"><span class="comment"># '\n'</span></span><br><span class="line"><span class="comment"># 'you are beautiful'</span></span><br><span class="line"><span class="comment"># '\n'</span></span><br><span class="line"><span class="comment"># 'Once upon a time there were three little sisters; and their names were\n'</span></span><br><span class="line"><span class="comment"># 'Elsie'</span></span><br><span class="line"><span class="comment"># ',\n'</span></span><br><span class="line"><span class="comment"># 'Lacie'</span></span><br><span class="line"><span class="comment"># ' and\n'</span></span><br><span class="line"><span class="comment"># 'Tillie'</span></span><br><span class="line"><span class="comment"># ';\nand they lived at the bottom of a well.'</span></span><br><span class="line"><span class="comment"># '\n'</span></span><br><span class="line"><span class="comment"># '...'</span></span><br><span class="line"><span class="comment"># '\n</span></span><br></pre></td></tr></table></figure>
<h4 id="stripped-strings"><a href="#stripped-strings" class="headerlink" title="stripped_strings"></a>stripped_strings</h4><p>去除空格空行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> soup.stripped_strings:</span><br><span class="line">    print(repr(str))</span><br><span class="line"><span class="comment"># "The Dormouse's story"</span></span><br><span class="line"><span class="comment"># 'you are beautiful'</span></span><br><span class="line"><span class="comment"># 'Once upon a time there were three little sisters; and their names were'</span></span><br><span class="line"><span class="comment"># 'Elsie'</span></span><br><span class="line"><span class="comment"># ','</span></span><br><span class="line"><span class="comment"># 'Lacie'</span></span><br><span class="line"><span class="comment"># 'and'</span></span><br><span class="line"><span class="comment"># 'Tillie'</span></span><br><span class="line"><span class="comment"># ';\nand they lived at the bottom of a well.'</span></span><br><span class="line"><span class="comment"># '...'</span></span><br></pre></td></tr></table></figure>
<p><a href="http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#id7" target="_blank" rel="external">http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#id7</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/02/24/【Python】BeautifulSoup使用/" class="archive-article-date">
  	<time datetime="2017-02-24T06:26:55.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-02-24</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Python/">Python</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【Python】视频资源" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/24/【Python】视频资源/">【Python】视频资源</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>python3英文视频教程(全87集) <a href="http://pan.baidu.com/s/1dDnGBvV" target="_blank" rel="external">http://pan.baidu.com/s/1dDnGBvV</a> </p>
<p>Python从入门到精通视频（全60集）链接：<a href="http://pan.baidu.com/s/1eQw2dd4" target="_blank" rel="external">http://pan.baidu.com/s/1eQw2dd4</a> 密码：9bdl </p>
<p>Python学习手册视频教程(全44集) <a href="http://pan.baidu.com/s/1o64tpf8" target="_blank" rel="external">http://pan.baidu.com/s/1o64tpf8</a> </p>
<p>零基础入门学习Python(全42集) 链接：<a href="http://pan.baidu.com/s/1qWNmdKo" target="_blank" rel="external">http://pan.baidu.com/s/1qWNmdKo</a> 密码：jrjy </p>
<p>中谷python视频教程（全38集） <a href="http://pan.baidu.com/s/1o6LUn1o" target="_blank" rel="external">http://pan.baidu.com/s/1o6LUn1o</a> </p>
<p>老男孩Python运维系统开发（全36集）链接：<a href="http://pan.baidu.com/s/1sjuJLEl" target="_blank" rel="external">http://pan.baidu.com/s/1sjuJLEl</a> 密码：kypb</p>
<p>Let’s-python系列视频教程（全25集） <a href="http://pan.baidu.com/s/1dD4BAi1" target="_blank" rel="external">http://pan.baidu.com/s/1dD4BAi1</a> </p>
<p>老男孩Python高级运维编程实战精品入门进阶（全27集） 链接：<a href="http://pan.baidu.com/s/1dDu2k61" target="_blank" rel="external">http://pan.baidu.com/s/1dDu2k61</a> 密码：q8s8 </p>
<p>播布客python基础教程(全21集) <a href="http://pan.baidu.com/s/1o6p0krC" target="_blank" rel="external">http://pan.baidu.com/s/1o6p0krC</a> </p>
<p>老男孩python运维视频教程（全15集）<a href="http://pan.baidu.com/s/1o6hYBqi" target="_blank" rel="external">http://pan.baidu.com/s/1o6hYBqi</a> </p>
<p>基于python web框架(全13集) <a href="http://pan.baidu.com/s/1mgFSE60" target="_blank" rel="external">http://pan.baidu.com/s/1mgFSE60</a> </p>
<p>Python.Django视频教程（全13集）<a href="http://pan.baidu.com/s/1mgC4RdY" target="_blank" rel="external">http://pan.baidu.com/s/1mgC4RdY</a> </p>
<p>python基础教程视频(全13集) <a href="http://pan.baidu.com/s/1kTDmOy7" target="_blank" rel="external">http://pan.baidu.com/s/1kTDmOy7</a> </p>
<p>老男孩python自动化运维视频教程（全9集）<a href="http://pan.baidu.com/s/1o6Fi9KI" target="_blank" rel="external">http://pan.baidu.com/s/1o6Fi9KI</a> </p>
<p>Python视频专题讲座（全9集） <a href="http://pan.baidu.com/s/1bndBuAr" target="_blank" rel="external">http://pan.baidu.com/s/1bndBuAr</a> </p>
<p>利用Python SOCKET多线程开发FTP软件（全6集）<a href="http://pan.baidu.com/s/1eQcPovo" target="_blank" rel="external">http://pan.baidu.com/s/1eQcPovo</a></p>
</blockquote>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/02/24/【Python】视频资源/" class="archive-article-date">
  	<time datetime="2017-02-24T03:44:55.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-02-24</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/视频资源/">视频资源</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Python/">Python</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ActiveMQ在Mac上的安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/03/ActiveMQ在Mac上的安装/">ActiveMQ在Mac上的安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>简单记录一下ActiveMQ在Mac上的安装。</p>
</blockquote>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/mqtttt.png" alt=""></p>
<h4 id="具体指令"><a href="#具体指令" class="headerlink" title="具体指令"></a>具体指令</h4><p>使用的是brew</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install activemq		<span class="comment">// 此过程需要下载组件，速度依据网速</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activemq --version			<span class="comment">// 安装成功之后，可以查看一下版本进行检查</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activemq start				<span class="comment">// 启动</span></span><br></pre></td></tr></table></figure>
<p>启动之后，可在浏览器中访问 <a href="http://localhost:8161/" target="_blank" rel="external">http://localhost:8161/</a></p>
<h4 id="其他操作指令"><a href="#其他操作指令" class="headerlink" title="其他操作指令"></a>其他操作指令</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Tasks:</span><br><span class="line">    browse                   - Display selected messages in a specified destination.</span><br><span class="line">    bstat                    - Performs a predefined query that displays useful statistics regarding the specified broker</span><br><span class="line">    consumer                 - Receives messages from the broker</span><br><span class="line">    create                   - Creates a runnable broker instance in the specified path.</span><br><span class="line">    decrypt                  - Decrypts given text</span><br><span class="line">    dstat                    - Performs a predefined query that displays useful tabular statistics regarding the specified destination type</span><br><span class="line">    encrypt                  - Encrypts given text</span><br><span class="line">    export                   - Exports a stopped brokers data files to an archive file</span><br><span class="line">    list                     - Lists all available brokers in the specified JMX context</span><br><span class="line">    producer                 - Sends messages to the broker</span><br><span class="line">    purge                    - Delete selected destination's messages that matches the message selector</span><br><span class="line">    query                    - Display selected broker component's attributes and statistics.</span><br><span class="line">    start                    - Creates and starts a broker using a configuration file, or a broker URI.</span><br><span class="line">    stop                     - Stops a running broker specified by the broker name.</span><br><span class="line"></span><br><span class="line">Task Options (Options specific to each task):</span><br><span class="line">    --extdir &lt;dir&gt; - Add the jar files in the directory to the classpath.</span><br><span class="line">    --version - Display the version information.</span><br><span class="line">    -h,-?,--help - Display this help information. To display task specific help, use Main [task] -h,-?,--help</span><br></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/02/03/ActiveMQ在Mac上的安装/" class="archive-article-date">
  	<time datetime="2017-02-03T02:00:18.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-02-03</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/MQTT/">MQTT</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-摄像头捕捉红包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/19/摄像头捕捉红包/">摄像头捕捉红包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>类似于QQ里面的捉财神，开红包游戏。</p>
</blockquote>
<p><a href="https://github.com/zhangzhaopds/CatchRedPacket.git" target="_blank" rel="external">https://github.com/zhangzhaopds/CatchRedPacket.git</a></p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/IMG_0601.PNG" alt=""></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/19/摄像头捕捉红包/" class="archive-article-date">
  	<time datetime="2017-01-19T01:34:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-19</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-iOS中的感应器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/iOS中的感应器/">iOS中的感应器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>iOS中的感应器：</p>
<p>​    <em>Accelerometer（加速器）</em></p>
<p>​    <em>Gyroscope（陀螺仪）</em></p>
<p>​    <em>Magnetometer（磁力计）</em></p>
<p>​    <em>Proximity（距离感应）</em></p>
<p>​    <em>Device motion</em></p>
<p>​    <em>CMPedometer（计步器）</em></p>
</blockquote>
<p><a href="https://github.com/zhangzhaopds/CMMotionManager_demo.git" target="_blank" rel="external">https://github.com/zhangzhaopds/CMMotionManager_demo.git</a></p>
<h4 id="Proximity-距离感应"><a href="#Proximity-距离感应" class="headerlink" title="Proximity-距离感应"></a>Proximity-距离感应</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启设备的距离感应(默认是关闭)</span></span><br><span class="line">        <span class="type">UIDevice</span>.current.isProximityMonitoringEnabled = <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加监听</span></span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: #selector(proximityStateChanged), name: <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="type">UIDeviceProximityStateDidChange</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 销毁监听</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.removeObserver(<span class="keyword">self</span>, name: <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="type">UIDeviceProximityStateDidChange</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听回调</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">proximityStateChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="type">UIDevice</span>.current.proximityState &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="literal">true</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"物体靠近"</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"物体远离"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="CoreMotion-加速器、陀螺仪、磁力计"><a href="#CoreMotion-加速器、陀螺仪、磁力计" class="headerlink" title="CoreMotion-加速器、陀螺仪、磁力计"></a>CoreMotion-加速器、陀螺仪、磁力计</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入CoreMotion框架</span></span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> motionManager = <span class="type">CMMotionManager</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 判断加速器是否可用</span></span><br><span class="line">        <span class="keyword">if</span> !motionManager.isAccelerometerAvailable &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"加速器不可用"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 采样间隔</span></span><br><span class="line">        motionManager.accelerometerUpdateInterval = <span class="number">0.3</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 加速器采样</span></span><br><span class="line">        motionManager.startAccelerometerUpdates(to: <span class="type">OperationQueue</span>.main) &#123; (accelerometerData, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> (error != <span class="literal">nil</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"加速器采样错误：<span class="subst">\(error)</span>"</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"加速器采样数据：<span class="subst">\(accelerometerData)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 螺旋仪</span></span><br><span class="line">        <span class="keyword">if</span> !motionManager.isGyroAvailable &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"螺旋仪不可用"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        motionManager.gyroUpdateInterval = <span class="number">0.3</span></span><br><span class="line">        motionManager.startGyroUpdates(to: <span class="type">OperationQueue</span>.main) &#123; (gyroData, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> (error != <span class="literal">nil</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"螺旋仪采样错误：<span class="subst">\(error)</span>"</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"螺旋仪数据：<span class="subst">\(gyroData)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 磁力计</span></span><br><span class="line">        <span class="keyword">if</span> !motionManager.isMagnetometerAvailable &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"磁力计不可用"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        motionManager.magnetometerUpdateInterval = <span class="number">0.3</span></span><br><span class="line">        motionManager.startMagnetometerUpdates(to: <span class="type">OperationQueue</span>.main) &#123; (magData, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"磁力计采样错误:<span class="subst">\(error)</span>"</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"磁力计数据：<span class="subst">\(magData)</span>"</span>)</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="摇一摇"><a href="#摇一摇" class="headerlink" title="摇一摇"></a>摇一摇</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">motionBegan</span><span class="params">(<span class="number">_</span> motion: UIEventSubtype, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.motionBegan(motion, with: event)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"开始摇一摇"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">motionCancelled</span><span class="params">(<span class="number">_</span> motion: UIEventSubtype, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.motionCancelled(motion, with: event)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"取消"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">motionEnded</span><span class="params">(<span class="number">_</span> motion: UIEventSubtype, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.motionEnded(motion, with: event)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"结束摇一摇"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="CMPedometer"><a href="#CMPedometer" class="headerlink" title="CMPedometer"></a>CMPedometer</h4><p>需先加入 <code>Privacy - Motion Usage Description</code>权限</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !<span class="type">CMPedometer</span>.isStepCountingAvailable() &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"计步器不可用"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> pedometer = <span class="type">CMPedometer</span>()</span><br><span class="line">        pedometer.startUpdates(from: <span class="type">Date</span>()) &#123; (data, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(error!)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(data?.numberOfSteps ?? <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/17/iOS中的感应器/" class="archive-article-date">
  	<time datetime="2017-01-17T08:54:30.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-17</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CoreMotion/">CoreMotion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/感应器/">感应器</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ERROR-While-executing-gem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/05/ERROR-While-executing-gem/">ERROR:  While executing gem</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Gem和CocoaPods更新时的一个报错。</p>
</blockquote>
<h4 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem <span class="operator"><span class="keyword">update</span> cocoapods <span class="comment">--pre</span></span></span><br></pre></td></tr></table></figure>
<h4 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR:  While executing gem ... (Errno::EPERM)</span><br><span class="line">    Operation not permitted - /usr/bin/xcodeproj</span><br></pre></td></tr></table></figure>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem update -n /usr/local/bin cocoapods</span><br></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/05/ERROR-While-executing-gem/" class="archive-article-date">
  	<time datetime="2017-01-05T07:48:27.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-05</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cocoapods/">cocoapods</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gem/">gem</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Cocoapods/">Cocoapods</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-逆向工程-微信自动抢红包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/04/逆向工程-微信自动抢红包/">逆向工程-微信自动抢红包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>微信自动抢红包。</p>
</blockquote>
<p>依托于iOS重签名开源框架 <strong>ios-app-signer</strong></p>
<p>项目源码地址: <a href="https://github.com/codesourse/iInjection" target="_blank" rel="external">https://github.com/codesourse/iInjection</a></p>
<p><strong>注：</strong>如果iTunes安装不成功的话，可尝试用OTA(亲测，好用)。</p>
<h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="http://7xoz39.com1.z0.glb.clouddn.com/weixinred1.PNG" alt=""></p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/weixinred2.PNG" alt=""></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/04/逆向工程-微信自动抢红包/" class="archive-article-date">
  	<time datetime="2017-01-04T08:30:02.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向工程、iOS-App-resign、微信红包/">逆向工程、iOS_App_resign、微信红包</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/逆向工程/">逆向工程</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-npm缺少package异常" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/30/npm缺少package异常/">npm missing package.json</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>在执行 <code>npm install &lt;模块&gt;</code>时，出现找不到文件路径 <code>package.json</code>等报错。</p>
</blockquote>
<h4 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h4><p><img src="http://7xoz39.com1.z0.glb.clouddn.com/npmerror.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zhangzhao:util zhangzhao$ npm <span class="operator"><span class="keyword">install</span> <span class="keyword">n</span>-crypto</span><br><span class="line">/<span class="keyword">Users</span>/zhangzhao</span><br><span class="line">└── <span class="keyword">n</span>-crypto@<span class="number">0.2</span><span class="number">.1</span> </span><br><span class="line"></span><br><span class="line">npm WARN enoent ENOENT: <span class="keyword">no</span> such <span class="keyword">file</span> <span class="keyword">or</span> <span class="keyword">directory</span>, <span class="keyword">open</span> <span class="string">'/Users/zhangzhao/package.json'</span></span><br><span class="line">npm WARN zhangzhao <span class="keyword">No</span> description</span><br><span class="line">npm WARN zhangzhao <span class="keyword">No</span> repository <span class="keyword">field</span>.</span><br><span class="line">npm WARN zhangzhao <span class="keyword">No</span> README <span class="keyword">data</span></span><br><span class="line">npm WARN zhangzhao <span class="keyword">No</span> license <span class="keyword">field</span>.</span></span><br></pre></td></tr></table></figure>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> <span class="comment">--save n-crypto</span></span></span><br></pre></td></tr></table></figure>
<p>参考地址：[<a href="https://github.com/npm/npm/issues/9161" target="_blank" rel="external">https://github.com/npm/npm/issues/9161</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/12/30/npm缺少package异常/" class="archive-article-date">
  	<time datetime="2016-12-30T08:58:57.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-30</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WARN/">WARN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npm/">npm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/package/">package</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/npm/">npm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Vapor实现Swift的Server搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/29/Vapor实现Swift的Server搭建/">Vapor实现Swift的Server搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>利用开源框架Vapor搭建Swift语言的服务器。</p>
</blockquote>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/vapor02.png" alt=""></p>
<p>本文翻译自：<a href="https://www.bignerdranch.com/blog/server-side-swift-with-vapor/" target="_blank" rel="external">https://www.bignerdranch.com/blog/server-side-swift-with-vapor/</a></p>
<h3 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h3><h4 id="1、Xcode-和-Swift"><a href="#1、Xcode-和-Swift" class="headerlink" title="1、Xcode 和 Swift"></a>1、Xcode 和 Swift</h4><p>第一件事就是下载最新的Xcode版本，其支持Swift3。</p>
<h4 id="2、Vapor"><a href="#2、Vapor" class="headerlink" title="2、Vapor"></a>2、Vapor</h4><p>第二件事就是安装Vapor和它的toolbox;</p>
<p>Vapor的官方文档：<a href="https://vapor.github.io/documentation/getting-started/install-swift-3-macos.html" target="_blank" rel="external">https://vapor.github.io/documentation/getting-started/install-swift-3-macos.html</a></p>
<p>具体的安装指令：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sL check.vapor.sh <span class="string">| bash</span></span><br></pre></td></tr></table></figure>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sL toolbox.vapor.sh <span class="string">| bash</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>第一条指令是为了验证Xcode的安装是否正确，可能会提醒设置Xcode的 <code>Command Line Tools</code>：</p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/vapor01.png" alt=""></p>
<p>第二条指令是为了安装toolbox工具，Xcode一定要处于打开状态，不然会有类似<code>No such file or directory</code>的报错。</p>
<h4 id="3、Postgres"><a href="#3、Postgres" class="headerlink" title="3、Postgres"></a>3、Postgres</h4><p>使用Postgres作为数据库。</p>
<p>如果已经安装了Homebrew,则可以执行下面的指令安装Postgres数据库；</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install postgres</span><br></pre></td></tr></table></figure>
<h4 id="4、Heroku"><a href="#4、Heroku" class="headerlink" title="4、Heroku"></a>4、Heroku</h4><p>在Heroku上面部署自己的云服务器。</p>
<p>需要注册，官网地址：<a href="https://dashboard.heroku.com/apps" target="_blank" rel="external">https://dashboard.heroku.com/apps</a>;</p>
<p>下载安装Heroku的Command Line: 地址：<a href="https://devcenter.heroku.com/articles/heroku-cli" target="_blank" rel="external">https://devcenter.heroku.com/articles/heroku-cli</a></p>
<h3 id="二、创建Vapor项目"><a href="#二、创建Vapor项目" class="headerlink" title="二、创建Vapor项目"></a>二、创建Vapor项目</h3><p>以下指令创建了一个名为 Friends 的App，创建过程较慢，耐心等待。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vapor <span class="keyword">new</span> Friends</span><br></pre></td></tr></table></figure>
<p>App创建成功之后，cd 到 Hello文件，执行以下指令，便可在Xcode中打开并运行项目。这个过程更加漫长。。。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">vapor</span> xcode -y</span><br></pre></td></tr></table></figure>
<h4 id="1、打开默认文件路径-http-localhost-8080"><a href="#1、打开默认文件路径-http-localhost-8080" class="headerlink" title="1、打开默认文件路径: http://localhost:8080"></a>1、打开默认文件路径: <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a></h4><p>在打开的工程中，导航至 Sources/App/main.swift， 看到的代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> drop = <span class="type">Droplet</span>()</span><br><span class="line"></span><br><span class="line">drop.<span class="keyword">get</span> &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> drop.view.make(<span class="string">"welcome"</span>, [</span><br><span class="line">        <span class="string">"message"</span>: drop.localization[req.lang, <span class="string">"welcome"</span>, <span class="string">"title"</span>]</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.resource(<span class="string">"posts"</span>, <span class="type">PostController</span>())</span><br><span class="line"></span><br><span class="line">drop.run()</span><br></pre></td></tr></table></figure>
<p>这个文件导入了Vapor框架，初始化一个Droplet类型对象，和添加了一个默认路径；</p>
<p>配置Xcode,如下，并Command+R运行：</p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/vapor03.png" alt=""></p>
<p>在浏览器中打开 <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a>,</p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/vapor04.png" alt=""></p>
<h4 id="2、创建一个新的访问路径-http-localhost-8080-friends"><a href="#2、创建一个新的访问路径-http-localhost-8080-friends" class="headerlink" title="2、创建一个新的访问路径: http://localhost:8080/friends"></a>2、创建一个新的访问路径: <a href="http://localhost:8080/friends" target="_blank" rel="external">http://localhost:8080/friends</a></h4><p>同样实在main.swift文件中操作，具体添加后的代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> drop = <span class="type">Droplet</span>()</span><br><span class="line"></span><br><span class="line">drop.<span class="keyword">get</span> &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> drop.view.make(<span class="string">"welcome"</span>, [</span><br><span class="line">        <span class="string">"message"</span>: drop.localization[req.lang, <span class="string">"welcome"</span>, <span class="string">"title"</span>]</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.<span class="keyword">get</span>(<span class="string">"friends"</span>) &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">JSON</span>(node: [<span class="string">"friends"</span>: [[<span class="string">"name"</span>: <span class="string">"Sarah"</span>, <span class="string">"age"</span>: <span class="number">33</span>],</span><br><span class="line">                                          [<span class="string">"name"</span>: <span class="string">"Steve"</span>, <span class="string">"age"</span>: <span class="number">31</span>],</span><br><span class="line">                                          [<span class="string">"name"</span>: <span class="string">"Drew"</span>, <span class="string">"age"</span>: <span class="number">35</span>]]</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.resource(<span class="string">"posts"</span>, <span class="type">PostController</span>())</span><br><span class="line"></span><br><span class="line">drop.run()</span><br></pre></td></tr></table></figure>
<p>friends路径接受get请求，返回一组json数据。浏览器访问效果如下：</p>
<p><img src="http://7xoz39.com1.z0.glb.clouddn.com/vapor05.png" alt=""></p>
<h4 id="3、创建一个Friend类型的Model"><a href="#3、创建一个Friend类型的Model" class="headerlink" title="3、创建一个Friend类型的Model"></a>3、创建一个Friend类型的Model</h4><p>在<code>Sources/App/Models</code>下创建一个<code>Friend.swift</code>文件:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Friend</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> email: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, age: <span class="type">Int</span>, email: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.age = age</span><br><span class="line">        <span class="keyword">self</span>.email = email</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>添加了一个email属性</p>
<p>Vapor提供了Model协议来保存model类型，同时也提供了方法来实现model到json的转换。为了结构体Friend遵从Model协议，我们需要导入在Friend.swift中导入Vapor库。</p>
<p>导入Vapor库的同时也意味着导入了Fluent库 。Fluent是针对Swift，处理众多数据库的对象关系映射工具（object relational mapping）。在这里我们使用它来处理我们的Postgres数据库。</p>
<p><strong>注意：</strong>当看到Xcode导入Vapor库之后，可能会看到报错，此时返回终端，重新执行 <code>vapor xcode -y</code>;</p>
<p>最终的Friend.swift文件应该是下面的样子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Friend</span>: <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> exists: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Node</span>?</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> email: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, age: <span class="type">Int</span>, email: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.age = age</span><br><span class="line">        <span class="keyword">self</span>.email = email</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NodeInitializable</span></span><br><span class="line">    <span class="keyword">init</span>(node: <span class="type">Node</span>, <span class="keyword">in</span> context: <span class="type">Context</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        id = <span class="keyword">try</span> node.extract(<span class="string">"id"</span>)</span><br><span class="line">        name = <span class="keyword">try</span> node.extract(<span class="string">"name"</span>)</span><br><span class="line">        age = <span class="keyword">try</span> node.extract(<span class="string">"age"</span>)</span><br><span class="line">        email = <span class="keyword">try</span> node.extract(<span class="string">"email"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NodeRepresentable</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">makeNode</span><span class="params">(context: Context)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Node</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">Node</span>(node: [<span class="string">"id"</span>: id,</span><br><span class="line">                                      <span class="string">"name"</span>: name,</span><br><span class="line">                                      <span class="string">"age"</span>: age,</span><br><span class="line">                                      <span class="string">"email"</span>: email])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Preparation</span></span><br><span class="line">    <span class="keyword">static</span> <span class="func"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(<span class="number">_</span> database: Database)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> database.create(<span class="string">"friends"</span>) &#123; friends <span class="keyword">in</span></span><br><span class="line">            friends.id()</span><br><span class="line">            friends.string(<span class="string">"name"</span>)</span><br><span class="line">            friends.int(<span class="string">"age"</span>)</span><br><span class="line">            friends.string(<span class="string">"email"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="func"><span class="keyword">func</span> <span class="title">revert</span><span class="params">(<span class="number">_</span> database: Database)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> database.delete(<span class="string">"friends"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一件事是我们要实现Model协议。意味着，我们需要一个<code>Node?</code>类型的<code>id</code>属性；id的值在保存到数据库之前是<code>nil</code>。Friend同时有一个默认值为<code>false</code>的<code>exists</code>的属性，这个属性展示的是从数据库中是否获取到实例对象（This property details whether or not the instance was retrieved from the database and should not be interacted with directly.）。</p>
<p>同时，我们还需要实现其他的协议。<code>NodeInitializable</code>，<code>NodeRepresentable</code>和<code>Preparation</code>。其中，前两个协议 的实现是因为 Model协议继承于Entity协议。第一个协议告诉我们怎样从数据库中初始化model；第二个协议是怎样保存model到数据库中。第三个协议是怎样创建数据库。</p>
<p>接下来，我们在main.swift中利用上面的Friend,在新的路径 friends下创建一个json,如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">drop.<span class="keyword">get</span>(<span class="string">"friends"</span>) &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> friends = [<span class="type">Friend</span>(name: <span class="string">"Sarah"</span>, age: <span class="number">33</span>, email:<span class="string">"sarah@email.com"</span>),</span><br><span class="line">                       <span class="type">Friend</span>(name: <span class="string">"Steve"</span>, age: <span class="number">31</span>, email:<span class="string">"steve@email.com"</span>),</span><br><span class="line">                       <span class="type">Friend</span>(name: <span class="string">"Drew"</span>, age: <span class="number">35</span>, email:<span class="string">"drew@email.com"</span>)]</span><br><span class="line">    <span class="keyword">let</span> friendsNode = <span class="keyword">try</span> friends.makeNode()</span><br><span class="line">    <span class="keyword">let</span> nodeDictionary = [<span class="string">"friends"</span>: friendsNode]</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">JSON</span>(node: nodeDictionary)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们创建了一个包含三个Friend对象的friends数组。之后数组调用<code>makeNode()</code>方法转换成一个Node。之后的字典和json结果。</p>
<p>重新运行Command+R，在浏览器中访问<a href="http://localhost:8080/friends，即可看到效果。" target="_blank" rel="external">http://localhost:8080/friends，即可看到效果。</a></p>
<h4 id="4、配置Postgres数据库"><a href="#4、配置Postgres数据库" class="headerlink" title="4、配置Postgres数据库"></a>4、配置Postgres数据库</h4><p>设置Postgres涉及几个步骤：</p>
<ol>
<li>在<code>Package.swift</code>中为Postgres添加一个provider；</li>
<li>在main.swift中导入provider，用Droplet来使用它；</li>
<li>配置我们的app使用Postgres；</li>
</ol>
<h5 id="获取一个provider"><a href="#获取一个provider" class="headerlink" title="获取一个provider"></a>获取一个provider</h5><p> <a href="https://github.com/vapor/postgresql-provider" target="_blank" rel="external">postgres-provider</a>是一个优秀的provider。在<code>Package.swift</code>添加这个依赖。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PackageDescription</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> package = <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">"Friends"</span>,</span><br><span class="line">    dependencies: [</span><br><span class="line">        .<span class="type">Package</span>(url: <span class="string">"https://github.com/vapor/vapor.git"</span>, majorVersion: <span class="number">1</span>, minor: <span class="number">1</span>),</span><br><span class="line">        .<span class="type">Package</span>(url: <span class="string">"https://github.com/vapor/postgresql-provider"</span>, majorVersion: <span class="number">1</span>, minor: <span class="number">0</span>)</span><br><span class="line">    ],</span><br><span class="line">    exclude: [</span><br><span class="line">        <span class="string">"Config"</span>,</span><br><span class="line">        <span class="string">"Database"</span>,</span><br><span class="line">        <span class="string">"Localization"</span>,</span><br><span class="line">        <span class="string">"Public"</span>,</span><br><span class="line">        <span class="string">"Resources"</span>,</span><br><span class="line">        <span class="string">"Tests"</span>,</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>之后，在终端执行 <code>vapor xcode -y</code>。</p>
<h5 id="导入provider"><a href="#导入provider" class="headerlink" title="导入provider"></a>导入provider</h5><p>打开main.swift，准备使用数据库Postgres。当然需要先安装Postgres。</p>
<p>Postgres地址：<a href="https://github.com/vapor/postgresql" target="_blank" rel="external">https://github.com/vapor/postgresql</a></p>
<p><em>MacOS上的Postgres安装使用指令：</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">brew <span class="operator"><span class="keyword">install</span> postgresql</span><br><span class="line">brew <span class="keyword">link</span> postgresql</span><br><span class="line">brew services <span class="keyword">start</span> postgresql</span><br><span class="line"></span><br><span class="line">// <span class="keyword">to</span> <span class="keyword">stop</span> </span><br><span class="line">brew services <span class="keyword">stop</span> postgresql</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong>我在Mac上<code>brew install postgresql</code>时出现404报错，导致Postgres安装失败，所以接下来的内容就没办法跟着原文继续实现。</p>
<p>首先，导入 <code>VaporPostgreSQL</code>;</p>
<p>其次，为Droplet的<code>preparations</code>添加<code>Friend.self</code> ;</p>
<p>最后，<code>drop.addProvider(VaporPostgreSQL.Provider.self)</code>,添加porvider到drop以使用数据库。</p>
<h5 id="在工程中配置Progres"><a href="#在工程中配置Progres" class="headerlink" title="在工程中配置Progres"></a>在工程中配置Progres</h5><p>在工程的<code>Config</code>文件夹下创建 <code>secrets</code>文件夹，并在secrets下创建 <code>postgresql.json</code>。最终的路径应该是这样的 <code>Config/secrets/postgresql.json</code>;而postgresql.json中内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">host</span>": <span class="value"><span class="string">"127.0.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">user</span>": <span class="value"><span class="string">"DubbaDubs"</span></span>,</span><br><span class="line">    "<span class="attribute">password</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">    "<span class="attribute">database</span>": <span class="value"><span class="string">"friends"</span></span>,</span><br><span class="line">    "<span class="attribute">port</span>": <span class="value"><span class="number">5432</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>注意：user要用你自己的；friends只是我们生命的一个数据库，仍旧需要创建它。</p>
<h5 id="使用Protgres"><a href="#使用Protgres" class="headerlink" title="使用Protgres"></a>使用Protgres</h5><p>接下来，我们创建一个新的路径，执行POST方法，将Friend数据保存到数据库；</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"><span class="keyword">import</span> VaporPostgreSQL</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> drop = <span class="type">Droplet</span>()</span><br><span class="line">drop.preparations.append(<span class="type">Friend</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> drop.addProvider(<span class="type">VaporPostgreSQL</span>.<span class="type">Provider</span>.<span class="keyword">self</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Error adding provider: <span class="subst">\(error)</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.<span class="keyword">get</span> &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> drop.view.make(<span class="string">"welcome"</span>, [</span><br><span class="line">        <span class="string">"message"</span>: drop.localization[req.lang, <span class="string">"welcome"</span>, <span class="string">"title"</span>] ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.<span class="keyword">get</span>(<span class="string">"friends"</span>) &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> friends = [<span class="type">Friend</span>(name: <span class="string">"Sarah"</span>, age: <span class="number">33</span>, email:<span class="string">"sarah@email.com"</span>),</span><br><span class="line">                       <span class="type">Friend</span>(name: <span class="string">"Steve"</span>, age: <span class="number">31</span>, email:<span class="string">"steve@email.com"</span>),</span><br><span class="line">                       <span class="type">Friend</span>(name: <span class="string">"Drew"</span>, age: <span class="number">35</span>, email:<span class="string">"drew@email.com"</span>)]</span><br><span class="line">    <span class="keyword">let</span> friendsNode = <span class="keyword">try</span> friends.makeNode()</span><br><span class="line">    <span class="keyword">let</span> nodeDictionary = [<span class="string">"friends"</span>: friendsNode]</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">JSON</span>(node: nodeDictionary)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.post(<span class="string">"friend"</span>) &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> friend = <span class="keyword">try</span> <span class="type">Friend</span>(node: req.json)</span><br><span class="line">    <span class="keyword">try</span> friend.save()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> friend.makeJSON()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">drop.resource(<span class="string">"posts"</span>, <span class="type">PostController</span>())</span><br><span class="line"></span><br><span class="line">drop.run()</span><br></pre></td></tr></table></figure>
<p>这个POST路径的body，类似下面：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Some Name"</span>,</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"email@email.com"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们尝试用<code>req.json</code>创建一个Friend类型的实例对象,作为POST请求发送出去；</p>
<p>之后，调用<code>friend.save()</code>将对象保存到数据库；</p>
<p>关于friend为什么用 <code>Var .save()</code>的理解：friend中有一个在保存到数据库之前是nil的<code>id</code>属性，这里的作用就是当成功保存到数据后，在回调中修正这个<code>id</code>的值。</p>
<p>我们仍旧需要创建数据库</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres -<span class="keyword">D</span> /usr/<span class="keyword">local</span>/<span class="keyword">var</span>/postgres/</span><br></pre></td></tr></table></figure>
<p>在终端执行上面的指令，Protgres 服务将在本地运行；一旦服务开始运行，我们就可以创建数据库。</p>
<p>在新的终端窗口，执行</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">createdb</span> friends</span><br><span class="line">psql</span><br></pre></td></tr></table></figure>
<p>之后，可以输入 <code>\l</code>来查看数据库列表，应该就可以看到你的friends数据库。</p>
<p>最后，你可以利用POSTMAN等工具发送一个post请求，测试一下。</p>
<p>然后用 <code>psql</code>来确认你发送数据到数据库了。</p>
<p>You can test this new route by building and running your app within Xcode as you did above and using <code>curl</code> or a tool like <a href="https://www.getpostman.com/" target="_blank" rel="external">Postman</a>. You can use <code>psql</code> to verify that you are posting data to the database. From inside the command line interface, type <code>\c friends</code> to connect to your friends database. Next, type <code>SELECT * FROM friends;</code> and hit enter. You should see the information for the friend that you just <code>POST</code>ed to the <code>&quot;friend&quot;</code> route.</p>
<h3 id="Removing-Hardcoded-Data"><a href="#Removing-Hardcoded-Data" class="headerlink" title="Removing Hardcoded Data"></a>Removing Hardcoded Data</h3><p><code>GET</code> requests to our <code>&quot;friends&quot;</code> currently return hardcoded data. But we can <code>POST</code>friends to our database now! Go ahead and <code>POST</code> a few more friends to your database to fill it out a little more.</p>
<p>Back in <code>main.swift</code>, let’s update our <code>&quot;friends&quot;</code> route to return the data in our database. That method should now look like this:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">drop.<span class="keyword">get</span>(<span class="string">"friends"</span>) &#123; req <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> friends = <span class="keyword">try</span> Friend.all().makeNode()</span><br><span class="line">    <span class="keyword">let</span> friendsDictionary = [<span class="string">"friends"</span>: friends]</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">try</span> <span class="title">JSON</span>(<span class="params">node: friendsDictionary</span>)</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Visit <a href="http://localhost:8080/friends" target="_blank" rel="external">http://localhost:8080/friends</a> in your browser or send a <code>GET</code> request via Postman and you should see your friends returned to you.</p>
<h2 id="GETting-by-id"><a href="#GETting-by-id" class="headerlink" title="GETting by id"></a><code>GET</code>ting by <code>id</code></h2><p>Add a new route to <code>main.swift</code> that will use a user’s <code>id</code> to find an entry in the database.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">drop.<span class="keyword">get</span>(<span class="string">"friends"</span>, <span class="type">Int</span>.<span class="keyword">self</span>) &#123; req, userID <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> friend = <span class="keyword">try</span> <span class="type">Friend</span>.<span class="built_in">find</span>(userID) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">Abort</span>.notFound</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> friend.makeJSON()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above will match a route that will end in something like, <code>.../friends/1</code>, where the integer at the end is the friend’s <code>id</code>. Notice that we use <code>Int.self</code> as the second argument in the path. This means that we can have type safe parameters in our routes! In Vapor, there is no need to cast this parameter from a <code>String</code> to an <code>Int</code>. We can express exactly what we need. The <code>userID</code> parameter in the closure will match the integer passed at the end of the route.</p>
<p>Also, through the power of Fluent, we can simply <code>find(_:)</code> the instance of our model by its <code>id</code>. Since this lookup can fail, we must <code>try</code>. If we fail to find a <code>Friend</code>, we’ll <code>throw</code> the error <code>Abort.notFound</code>. Otherwise, we <code>makeJSON()</code> from the <code>friend</code> we found and return. Go ahead and try it out!</p>
<h2 id="部署到-Heroku"><a href="#部署到-Heroku" class="headerlink" title="部署到 Heroku"></a>部署到 Heroku</h2><p>All that is left to do is to deploy to Heroku. Vapor makes this process very easy.</p>
<p>Heroku works with Git, so you should make sure that you have that installed as well. Create a Git repository and commit your files.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git <span class="operator"><span class="keyword">commit</span> -<span class="keyword">m</span> <span class="string">"Initial commit"</span></span></span><br></pre></td></tr></table></figure>
<p>Now, all you need to do is create a Heroku instance and push to it.</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">vapor</span> heroku init</span><br></pre></td></tr></table></figure>
<p>The Heroku CLI will ask four questions:</p>
<p><em>Would you like to provide a custom Heroku app name?</em> Answer ‘n’ and hit enter if you don’t have a custom name.</p>
<p><em>Would you like to provide a custom Heroku buildpack?</em> Answer ‘n’ and hit enter if you would like to use the default buildpack that Heroku provides.</p>
<p><em>Are you using a custom Executable name?</em> Answer ‘n’ and hit enter here if you aren’t using a custom executable name.</p>
<p><em>Would you like to push to Heroku now?</em> Answer ‘n’ and hit enter.</p>
<p>We need to answer ‘no’ because we need to configure our database to work online. We’ll do that below.</p>
<p>Before you plug the URL you see in your Terminal output into your browser of choice, we need to provision a Postgres add-on on Heroku. Type the following in your Terminal to add Postgres to your app.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">heroku</span> <span class="tag">addons</span><span class="pseudo">:create</span> <span class="tag">heroku-postgresql</span><span class="pseudo">:hobby-dev</span></span><br></pre></td></tr></table></figure>
<p>Adding the database can take up to five minutes to provision. Once it is ready, you can type <code>heroku config</code> in Terminal to see your database’s URL to confirm that the add-on was provisioned.</p>
<p>Now, we need to update our app’s <code>Procfile</code>, which was created via <code>vapor heroku init</code>, to use the <code>DATABASE_URL</code> environment variable that was created by Heroku. Open the <code>Procfile</code> in your text editor and update it so that looks like the below.</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">web: App --env=production --workdir=<span class="string">"./"</span></span><br><span class="line">web: App --env=production --workdir=./ --config:servers.<span class="keyword">default</span>.port=<span class="variable">$PORT</span> --config:postgresql.url=<span class="variable">$DATABASE</span>_URL</span><br></pre></td></tr></table></figure>
<p>Notice that we added a new configuration so that Heroku knows to use our database’s URL on the web and not the instance we have been running locally: <code>--config:postgresql.url=$DATABASE_URL</code>.</p>
<p>Save the Procfile and type <code>git push heroku master</code> in Terminal to deploy your app.</p>
<p>Deploying will take a few minutes. Heroku needs to build your application, install Swift on your Heroku instance, and so on. After some time, your app will be live on the web.</p>
<p>Note that we didn’t push up the data from the local database to the remote database. You will have to exercise your app’s API to add some data to your database on Heroku.</p>
<h3 id="Making-Changes"><a href="#Making-Changes" class="headerlink" title="Making Changes"></a>Making Changes</h3><p>Making changes is easy! Simply write your code, commit the changes, and push them up to Heroku.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="operator"><span class="keyword">commit</span> -am <span class="string">"Adds new code"</span></span><br><span class="line">git push heroku <span class="keyword">master</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h2><p>This post covered a lot of ground: We downloaded a number of tools. Introduced Vapor. Wrote a small web app. Developed an API to read and write some data to Postgres. Finally, we deployed the app to Heroku.</p>
<p>This post is intended to you get started with server-side Swift. To that end, we introduced Vapor and explored some of its features. But this introduction just scratches the surface; there is a lot more to Vapor. What’s exciting is that server-side Swift is moving fast! Stay tuned here for more posts on the subject.</p>
<h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>If you’re looking for more to do on your own, try your hand at these extra challenges.</p>
<ul>
<li>Create a route to <code>DELETE</code> a friend from the database.</li>
<li>Create a route to <code>PATCH</code> a friend on the database.</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/12/29/Vapor实现Swift的Server搭建/" class="archive-article-date">
  	<time datetime="2016-12-29T02:19:06.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Postgres/">Postgres</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift服务器/">Swift服务器</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vapor/">Vapor</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Jmsp
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: false
	}
</script>

<script src="/./main.js" type="text/javascript"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
    
    
    
  </ul>
  <div class="tools-wrap">
    

    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>